branches:
  only:
    - test/e2e-ci

language: android
jdk: oraclejdk11

env:
  global:
    - BUILD_API=31
    - BUILD_TOOLS=31.0.0
    - ANDROID_HOME=/usr/local/android-sdk
    - TOOLS=${ANDROID_HOME}/cmdline-tools/latest

android:
  components:
    - tools

licenses:
  - 'android-sdk-preview-license-.+'
  - 'android-sdk-license-.+'
  - 'google-gdk-license-.+'

before_install:
  # Install cmdline-tools (older tools doesn't support Java 11)
  - wget -q "https://dl.google.com/android/repository/commandlinetools-linux-7583922_latest.zip" -O android-commandline-tools-linux.zip
  - mkdir -p ${ANDROID_HOME}/cmdline-tools
  - unzip -q android-commandline-tools-linux.zip -d ${ANDROID_HOME}/cmdline-tools
  - mv ${ANDROID_HOME}/cmdline-tools/cmdline-tools ${ANDROID_HOME}/cmdline-tools/latest

before_script:
  - echo y | ${TOOLS}/bin/sdkmanager "platform-tools" >/dev/null
  - echo y | ${TOOLS}/bin/sdkmanager "tools" >/dev/null
  - echo y | ${TOOLS}/bin/sdkmanager "build-tools;$BUILD_TOOLS" >/dev/null
  - echo y | ${TOOLS}/bin/sdkmanager "platforms;android-$BUILD_API" >/dev/null
  - echo y | ${TOOLS}/bin/sdkmanager "extras;android;m2repository" >/dev/null

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    - $HOME/.android/build-cach

script:
  - yarn android
  # - yarn ci:e2e
# matrix:
#   include:
#     # - os: osx
#     #   language: objective-c
#     #   osx_image: xcodeX.X
#     #   script:

#     - os: linux
#       language: android
#       jdk: oraclejdk11
#       dist: trusty
#       sudo: required
#       android:
#         components:
#           - platform-tools
#           - tools
#           - build-tools-33.0.3
#           - android-26
#           - android-29
#           - sys-img-armeabi-v7a-android-29
#           - extra-android-m2repository
#           - extra-google-m2repository
#           - extra-google-google_play_services
#       script:
#         - echo no | android create avd --force -n test -t android-29 --abi armeabi-v7a
#         - nvm install 16.13.1
#         - node -v
#         - npm install --global yarn
#         - yarn -v
#         - yarn
#         - yarn ci:e2e
