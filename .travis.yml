branches:
  only:
    - test/e2e-ci

language: android
dist: trusty
android:
  components:
    - tools
    - platform-tools
    - tools
    - extra-google-google_play_services
    - extra-android-m2repository
  licenses:
    - 'android-sdk-preview-license-.+'
    - 'android-sdk-license-.+'
    - 'google-gdk-license-.+'

before_install:
  - touch $HOME/.android/repositories.cfg
  # Android API Level 30
  - yes | sdkmanager "platforms;android-30"
  - yes | sdkmanager "build-tools;30.0.2"
  # Android API Level 31
  - yes | sdkmanager "platforms;android-31"
  - yes | sdkmanager "build-tools;31.0.0"
  # Android API Level 32
  - yes | sdkmanager "platforms;android-32"
  - yes | sdkmanager "build-tools;32.0.0"
  - nvm install 16.13.1
  - node -v
  - npm install --global yarn
  - yarn -v

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - $HOME/.android/build-cache

script:
  - sdkmanager --list
  - export ANDROID_HOME=~/android-sdk
  - yarn
  - npx react-native run-android --variant=release
